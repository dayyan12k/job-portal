<!DOCTYPE html>
<html th:replace="~{base :: parent(~{::#content}, ~{::title})}" xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Saved Jobs</title>
</head>

<body class="bg-gray-50">
    <div id="content" class="mt-16 p-4">
        <!-- Page Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900">My Saved Jobs</h1>
            <p class="text-gray-600 mt-2">Jobs you've bookmarked for later</p>
        </div>
        
        <div class="max-w-6xl mx-auto">
            <!-- Empty State -->
            <div th:if="${savedJobs.size()} == 0" class="text-center py-12">
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">No Saved Jobs Yet</h3>
                <p class="text-gray-600 mb-6">Start browsing jobs and save the ones you're interested in!</p>
                <a href="/view_jobs" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    Browse Jobs
                </a>
            </div>
            
            <!-- Saved Jobs Grid -->
            <div th:if="${savedJobs.size()} > 0" class="space-y-4">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">
                        <span th:text="${savedJobs.size()}">0</span> Saved Jobs
                    </h2>
                    <a href="/view_jobs" class="text-blue-600 hover:text-blue-800 font-medium transition-colors">
                        Browse More Jobs â†’
                    </a>
                </div>
                
                <div class="bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow duration-200 relative" 
                     th:each="job : ${savedJobs}">
                    
                    <!-- Saved Badge -->
                    <div class="absolute top-6 right-6">
                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium">Saved</span>
                    </div>
                    
                    <!-- Job Content -->
                    <div class="pr-20">
                        <!-- Job Title -->
                        <h3 class="text-lg font-semibold text-gray-900 mb-2 hover:text-blue-600 cursor-pointer" 
                            th:text="${job.name}">Job Name</h3>
                        
                        <!-- Company Info -->
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-gray-700 font-medium" th:text="${job.company != null ? job.company.name : 'Company Name'}">Company Name</span>
                            <div class="flex items-center gap-1">
                                <span class="text-yellow-400">â˜…</span>
                                <span class="text-sm text-gray-600">4.2 | 1234 Reviews</span>
                            </div>
                        </div>
                        
                        <!-- Job Meta Information -->
                        <div class="flex items-center gap-6 mb-3 text-sm text-gray-600">
                            <!-- Experience -->
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0H8m8 0v2a4 4 0 01-8 0V6"></path>
                                </svg>
                                <span>0-2 Yrs</span>
                            </div>
                            
                            <!-- Salary -->
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                </svg>
                                <span>â‚¹<span th:text="${job.salary}">0000</span></span>
                            </div>
                            
                            <!-- Location -->
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span th:text="${job.location}">Location</span>
                            </div>

                            <!-- Date Saved -->
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span th:text="${helper.formatTimeAgo(job.createdAt)}">Posted time</span>
                            </div>
                        </div>
                        
                        <!-- Job Description -->
                        <div class="mb-4">
                            <p class="text-gray-700 text-sm leading-relaxed line-clamp-2">
                                <span class="font-medium">Job Summary: </span>
                                <span th:text="${job.description}">Job description here...</span>
                            </p>
                        </div>
                        
                        <!-- Footer with Actions -->
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-blue-600 font-medium">ðŸ’¾ Saved to your list</span>
                            
                            <div class="flex items-center gap-3">
                                <!-- View Details Button -->
                                <button class="flex items-center gap-1 text-sm text-gray-600 hover:text-gray-800 transition-colors"
                                        th:onclick="'showDetails(' + ${job.id} + ')'">                               
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                    </svg>
                                    View Details
                                </button>
                                
                                <!-- Remove from Saved Button -->
                                <button class="flex items-center gap-1 text-sm text-red-600 hover:text-red-800 transition-colors"
                                        th:data-job-id="${job.id}"
                                        onclick="removeSavedJob(this)">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                    Remove
                                </button>
                                
                                <!-- Apply Button -->
                                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                                    Apply Now
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Job Details Modal -->
                    <div th:id="'details-' + ${job.id}" 
                         class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
                        <div class="bg-white p-6 rounded-lg w-full max-w-md mx-4 shadow-xl relative">
                            <h3 class="text-xl font-bold mb-4 text-gray-900" th:text="${job.name}">Job Name</h3>
                            
                            <div class="space-y-3">
                                <div>
                                    <span class="font-semibold text-gray-700">Description:</span>
                                    <p class="text-gray-600 mt-1" th:text="${job.description}">Description</p>
                                </div>
                                
                                <div>
                                    <span class="font-semibold text-gray-700">Company:</span>
                                    <p class="text-gray-600 mt-1" th:text="${job.company != null ? job.company.name : 'N/A'}">Company</p>
                                </div>
                                
                                <div>
                                    <span class="font-semibold text-gray-700">Location:</span>
                                    <p class="text-gray-600 mt-1" th:text="${job.location}">Location</p>
                                </div>
                                
                                <div>
                                    <span class="font-semibold text-gray-700">Salary:</span>
                                    <p class="text-gray-600 mt-1">â‚¹<span th:text="${job.salary}">0000</span></p>
                                </div>
                            </div>
                            
                            <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors"
                                th:onclick="'hideDetails(' + ${job.id} + ')'">
                                Ã—
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Show job details modal
        function showDetails(jobId) {
            const modal = document.getElementById('details-' + jobId);
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }

        // Hide job details modal
        function hideDetails(jobId) {
            const modal = document.getElementById('details-' + jobId);
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        // Remove job from saved list
        function removeSavedJob(button) {
            const jobId = button.getAttribute('data-job-id');
            
            // Disable button during request
            button.disabled = true;
            button.style.opacity = '0.5';
            
            fetch(`/user/unsave-job/${jobId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.text())
            .then(data => {
                if (data === 'unsaved') {
                    // Remove the job card with animation
                    const jobCard = button.closest('.bg-white');
                    jobCard.style.transition = 'opacity 0.3s ease';
                    jobCard.style.opacity = '0';
                    setTimeout(() => {
                        jobCard.remove();
                        // Check if no jobs left and show empty state
                        const remainingJobs = document.querySelectorAll('.bg-white.rounded-lg').length;
                        if (remainingJobs === 0) {
                            location.reload();
                        }
                    }, 300);
                } else {
                    alert('Failed to remove job. Please try again.');
                    button.disabled = false;
                    button.style.opacity = '1';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
                button.disabled = false;
                button.style.opacity = '1';
            });
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('bg-black') && event.target.classList.contains('bg-opacity-50')) {
                event.target.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const activeModals = document.querySelectorAll('.fixed:not(.hidden)');
                activeModals.forEach(modal => {
                    if (modal.id.startsWith('details-')) {
                        modal.classList.add('hidden');
                        document.body.style.overflow = 'auto';
                    }
                });
            }
        });
    </script>
</body>
</html>
